<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Generator Token OAuth2 — Google Drive</title>

    <!-- Bootstrap 5.3 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
      integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link rel="stylesheet" href="assets/oauth2/css/style.css" />
    <style>
      body {
        background-color: #f5f7fb;
      }
      .token-box {
        word-break: break-all;
        max-height: 220px;
        overflow: auto;
        background: #fff;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #e6e9ef;
      }
      .small-note {
        font-size: 0.85rem;
        color: #51545a;
      }
      .google-logo {
        width: 64px;
        height: 64px;
      }
    </style>
  </head>
  <body>
    <div id="app" class="container py-5">
      <div class="row g-4">
        <!-- Kiri -->
        <div class="col-lg-4 order-lg-2">
          <div class="card shadow-sm mb-2 text-center">
            <div class="card-body">
              <img
                src="https://www.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png"
                class="google-logo mb-2"
                alt="Google Drive"
              />
              <h6>Google Drive For FillX</h6>
              <p class="text-muted small">
                Alat ini membantu Anda untuk menghubungkan akun
                <strong>Google Drive</strong> dengan <strong>FillX</strong>.
                Client ID dan Client Secret hanya disimpan sementara di
                <code>sessionStorage</code> selama sesi browser dan tidak pernah
                disimpan permanen.
              </p>
              <p class="text-muted small">
                Untuk keamanan, lakukan proses ini hanya melalui aplikasi FillX.
              </p>
            </div>
          </div>
        </div>
        <!-- Kanan -->
        <div class="col-lg-8">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title">Google Drive For FillX</h5>
              <div class="alert alert-info mb-3">
                <h6>Cara Kerja</h6>
                <ol class="small">
                  <li>Isi Client ID & Client Secret.</li>
                  <li>Klik <em>Buat</em> → login & setujui akses di Google.</li>
                  <li>
                    Setelah disetujui, Anda akan diarahkan kembali ke halaman
                    ini dan token otomatis dibuat.
                  </li>
                </ol>
              </div>
              <p style="color: red; font-weight: bold">
                ⚠️ Token bersifat sangat sensitif. Jangan pernah membagikan
                kepada siapapun yang tidak anda percayai. Jika memang harus
                dibagikan, pastikan hanya kepada pihak yang terpercaya.
                <span class="text-bg-danger"
                  >Demi keamanan, gunakan akun Google baru khusus</span
                >
                untuk integrasi agar terhindar dari risiko kebocoran data di
                akun utama Anda.
              </p>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="clientId" class="form-label">Client ID</label>
                  <input
                    id="clientId"
                    type="text"
                    v-model="clientId"
                    class="form-control"
                  />
                </div>

                <div class="col-md-6">
                  <label for="clientSecret" class="form-label"
                    >Client Secret</label
                  >
                  <input
                    id="clientSecret"
                    type="text"
                    v-model="clientSecret"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <a href="#tutorial" class="btn btn-link p-0 ps-1 small">
                    Tutorial Membuat Client ID & Client Secret
                  </a>
                </div>

                <div class="col-12">
                  <label for="scopes" class="form-label"
                    >Scopes (pisahkan dengan spasi)</label
                  >
                  <input
                    id="scopes"
                    type="text"
                    v-model="scopes"
                    class="form-control"
                  />
                  <div class="small-note mt-1">
                    Default:
                    <code>https://www.googleapis.com/auth/drive</code>
                  </div>
                </div>

                <div class="col-12">
                  <div class="d-flex gap-2 flex-wrap">
                    <button
                      class="btn btn-primary"
                      @click="generate"
                      :disabled="loading"
                    >
                      <i class="bi bi-box-arrow-up-right"></i> Buat & Login
                      Google
                    </button>
                    <button class="btn btn-secondary" @click="clearSession">
                      Hapus Sesi
                    </button>
                  </div>
                </div>

                <div class="col-12 mt-3">
                  <p class="small-note">
                    Status: <strong>{{statusMessage}}</strong>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Hasil Token -->
          <section id="hasil">
            <div v-if="tokenData" v-show="url" class="card shadow-sm mb-3">
              <div class="card-body">
                <h6 class="card-title">Hasil Token</h6>
                <div class="alert alert-danger">
                  <strong>Peringatan</strong>, Jangan pernah membagikan
                  informasi dibawah ini kepada siapapun yang tidak anda
                  percayai, silakan scan QRCode dibawah ini pakai Aplikasi FillX
                </div>
                <div class="row g-3">
                  <!-- <div class="col-md-6">
                  <label class="form-label">Access Token</label>
                  <div class="token-box">{{ tokenData.access_token }}</div>
                  <button
                    class="btn btn-sm btn-outline-primary mt-1"
                    @click="copy(tokenData.access_token)"
                  >
                    Salin
                  </button>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Refresh Token</label>
                  <div class="token-box">
                    {{ tokenData.refresh_token || '(tidak ada refresh token)' }}
                  </div>
                  <button
                    class="btn btn-sm btn-outline-primary mt-1"
                    @click="copy(tokenData.refresh_token)"
                  >
                    Salin
                  </button>
                </div>
                
                <div class="col-12">
                  <label class="form-label">Token Berlaku Hingga</label>
                  <div class="token-box">{{ expiresAtStr }}</div>
                </div>

                <div class="col-12">
                  <label class="form-label">Scope</label>
                  <div class="token-box">{{ tokenData.scope }}</div>
                </div> -->

                  <div class="col-12">
                    <div class="qrcode-wrapper">
                      <div id="qrcode"></div>
                      <div class="qrcode-text">
                        Scan QRCode untuk mendapatkan token ke Aplikasi FillX
                      </div>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="d-flex justify-content-center gap-2 flex-wrap">
                      <button class="btn btn-primary" @click="openApp">
                        Buka Di Aplikasi
                      </button>
                      <!-- <button class="btn btn-success" @click="downloadJson">
                        Unduh JSON
                      </button> -->
                      <button class="btn btn-danger" @click="clearTokens">
                        Hapus Token
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section id="tutorial">
            <div class="card shadow-sm mb-3">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  Panduan Setup Google Drive API untuk Penyimpanan FillX
                </h5>
              </div>
              <div class="card-body">
                <ol class="mb-3">
                  <li>
                    Kunjungi
                    <a href="https://console.cloud.google.com/" target="_blank"
                      >Google Cloud Console</a
                    >.
                  </li>
                  <li>
                    Buat <strong>project baru</strong> dan beri nama
                    <em>"Penyimpanan FillX"</em>.
                  </li>
                  <li>Pilih project yang sudah dibuat.</li>
                  <li>
                    Aktifkan layanan Google Drive API:
                    <ul>
                      <li>Buka menu <strong>API & Services</strong>.</li>
                      <li>
                        Cari <em>Google Drive API</em>, lalu klik
                        <strong>Enable</strong>.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Atur <strong>OAuth Consent Screen</strong>:
                    <ul>
                      <li>App name: <em>Penyimpanan FillX</em></li>
                      <li>Audience: <em>External</em></li>
                      <li>Contact Information: masukkan email Anda</li>
                      <li>
                        Klik <strong>Finish</strong> → <strong>Agree</strong> →
                        <strong>Create</strong>
                      </li>
                    </ul>
                  </li>
                  <li>
                    Buat <strong>Credentials → OAuth Client ID</strong>:
                    <ul>
                      <li>Application Type: <em>Web Application</em></li>
                      <li>Name: <em>Penyimpanan FillX</em></li>
                      <li>
                        Authorized JavaScript Origins: <em>(kosongkan)</em>
                      </li>
                      <li>
                        Authorized Redirect URIs:
                        <code
                          >https://fillx-app.github.io/oauth2/oauth2.html</code
                        >
                      </li>
                      <li>Klik <strong>Create</strong></li>
                    </ul>
                  </li>
                  <li>
                    Simpan hasil pembuatan OAuth Client:
                    <ul>
                      <li>
                        Catat <strong>Client ID</strong> dan
                        <strong>Client Secret</strong>.
                      </li>
                      <li>
                        Client Secret hanya terlihat sekali, jadi salin dan
                        simpan aman untuk digunakan pada Google Drive For FillX.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Tentukan <strong>Audience</strong>:
                    <ul>
                      <li>
                        Buka menu <em>Consent Screen</em> → pilih
                        <strong>Audience</strong>.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Tambah <strong>Test Users</strong>:
                    <ul>
                      <li>
                        Masukkan email pemilik project agar akses terbatas dan
                        aman.
                      </li>
                      <li>
                        <strong>JANGAN publish app</strong> agar tidak terbuka
                        untuk umum.
                      </li>
                    </ul>
                  </li>
                </ol>

                <div class="alert alert-warning mt-3 mb-0">
                  <strong>Catatan Penting:</strong> Pastikan hanya email pemilik
                  project yang dimasukkan sebagai Test User. Jangan pernah
                  mempublikasikan aplikasi ini agar tidak bisa diakses pihak
                  lain.
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="assets/oauth2/js/app.js"></script>
    <script src="assets/oauth2/js/gdrive.js"></script>
  </body>
</html>
